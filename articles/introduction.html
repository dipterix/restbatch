<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1. Introduction • restbatch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="1. Introduction">
<meta property="og:description" content="restbatch">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">restbatch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">1. Introduction</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dipterix/restbatch/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="introduction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>1. Introduction</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dipterix/restbatch/blob/master/vignettes/introduction.Rmd"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<div id="why-restbatch" class="section level2">
<h2 class="hasAnchor">
<a href="#why-restbatch" class="anchor"></a>1. Why <code>restbatch</code>
</h2>
<p>Many algorithms require minutes, hours, or even days to run. <code>restbatch</code> provides an implementation that runs in the background managing the running algorithms (tasks) and automatically dispatch to the clusters (if configured). The dispatcher (server) can be set as a service that runs even after the current session closed. For example:</p>
<p>Use-case 1: users can schedule tasks, let the tasks running without blocking the systems. They may even exit the session, and pick the results up next morning in another session.</p>
<p>Use-case 2: R-shiny apps can schedule hundreds of tasks without freezing the front-end website. The tasks run even after current shiny sessions becoming expired. The users can retrieve their results in new sessions.</p>
</div>
<div id="a-simple-show-case" class="section level2">
<h2 class="hasAnchor">
<a href="#a-simple-show-case" class="anchor"></a>2. A simple show-case</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dipterix/restbatch">restbatch</a></span><span class="op">)</span></code></pre></div>
<div id="start-a-server" class="section level3">
<h3 class="hasAnchor">
<a href="#start-a-server" class="anchor"></a>2.1 Start a server</h3>
<p>A local server can be started with a single line. This will start a service that runs in the background.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/restbatch-server.html">start_server</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Starting a restbatch server at http://127.0.0.1:7033</span>
<span class="co">#&gt; You have chosen this server to be the default server.</span></code></pre></div>
<p>By default, the local server runs at port <code>7033</code> on the ‘localhost’ IP <code>127.0.0.1</code>. It only receives request from your own computer, and rejects requests from anyone else. The port <code>7033</code> will be occupied by the <code>restbatch</code> service.</p>
<p>Once the service is started, it may take a while to get everything set up. you can use <code>server_alive</code> function to validate the server status.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/restbatch-server.html">server_alive</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; attr(,"response")</span>
<span class="co">#&gt; Response [http://127.0.0.1:7033/validate/ping]</span>
<span class="co">#&gt;   Date: 2021-02-11 18:16</span>
<span class="co">#&gt;   Status: 200</span>
<span class="co">#&gt;   Content-Type: application/json</span>
<span class="co">#&gt;   Size: 652 B</span>
<span class="co">#&gt; </span></code></pre></div>
<p>Alternatively, you can use <code>ensure_server</code> to start a server, and wait until the server is ready.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/restbatch-server.html">ensure_server</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="create-submit-monitor-collect-restore-and-remove-a-task" class="section level3">
<h3 class="hasAnchor">
<a href="#create-submit-monitor-collect-restore-and-remove-a-task" class="anchor"></a>2.2 Create, submit, monitor, collect, restore, and remove a task</h3>
<p>Let’s approximate <code>pi</code> using the following function and we want to see how close approximation can be by setting different <code>n</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">piApprox</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
  <span class="fl">4</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">d</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Create a task: A task can be created via <code>new_task2</code>
</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">task</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/restbench-tasks.html">new_task2</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>
  <span class="fu">piApprox</span><span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="va">x</span><span class="op">)</span>
<span class="op">}</span>, x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, task_name <span class="op">=</span> <span class="st">"demo_task"</span><span class="op">)</span>

<span class="va">task</span>
<span class="co">#&gt; Task (client proxy from the `restbatch` package)</span>
<span class="co">#&gt; Task name : [22dbdc9ec25174a768c15e03c7356780__demo_task__452ce031c6ba672d]</span>
<span class="co">#&gt; Total jobs: 8</span>
<span class="co">#&gt; Submitted to: [NA]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; * Use `task$submit()` to submit this task</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Submit a task: To start the task, submit to the <code>restbatch</code> server:</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">task</span><span class="op">$</span><span class="fu">submit</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Monitor a task: You can monitor and track the progress using <code>task$monitor()</code>.</li>
</ol>
<pre><code>Task ID name: 22dbdc9ec25174a768c15e03c7356780__demo_task__452ce031c6ba672d
Task local path: /Users/dipterix/tasks/...

Task has not been submitted/scheduled. Please run the following command to 
submit task:

    task$submit()

Jobs submitted to: 127.0.0.1:7033

You can download the task results once it's finished: 
    http://127.0.0.1:7033/info/results?task_name=22dbdc9ec25174a768c15e03c7356780_
_demo_task__452ce031c6ba672d

Start listening to the server report...
6 finished out of 8
7 finished out of 8
8 finished out of 8

Task finished</code></pre>
<p>Alternatively, you can use <code>task$resolved()</code>, or <code>task$server_status()</code> to check if it’s finished.</p>
<pre><code>task$resolved()
#&gt; [1] TRUE

as.data.frame(task$server_status())
#&gt;   status error           timestamp message n_total n_started n_done n_error
#&gt; 1 finish FALSE 2021-02-11 14:40:23      OK       8         8      8       0</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Restore a task: Once resolved, <code>collect</code> method will read the results into memory:</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="fu">collect</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 3.200000 3.160000 3.196000 3.136000 3.146120 3.141448 3.141256 3.141440</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Restore a task from another places: Once a task is created, you can always restore the results in another R session using <code>restore_task2</code> function. The task name can be obtained from previous <code>task$task_name</code> field.</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">task_restored</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/restbench-tasks.html">restore_task2</a></span><span class="op">(</span>
  task_name <span class="op">=</span> <span class="st">"22dbdc9ec25174a768c15e03c7356780__demo_task__452ce031c6ba672d"</span>
<span class="op">)</span>

<span class="va">task_restored</span>
<span class="co">#&gt; Task (client proxy from the `restbatch` package)</span>
<span class="co">#&gt; Task name : [22dbdc9ec25174a768c15e03c7356780__demo_task__452ce031c6ba672d]</span>
<span class="co">#&gt; Total jobs: 8</span>
<span class="co">#&gt; Submitted to: http://127.0.0.1:7033/</span>
<span class="co">#&gt; Status for 8 jobs at 2021-02-11 14:48:42:</span>
<span class="co">#&gt;   Submitted    : 8 (100.0%)</span>
<span class="co">#&gt;   -- Queued    : 0 (  0.0%)</span>
<span class="co">#&gt;   -- Started   : 8 (100.0%)</span>
<span class="co">#&gt;   ---- Running : 0 (  0.0%)</span>
<span class="co">#&gt;   ---- Done    : 8 (100.0%)</span>
<span class="co">#&gt;   ---- Error   : 0 (  0.0%)</span>
<span class="co">#&gt;   ---- Expired : 0 (  0.0%)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; *The task is finished, but the result has not been collected yet.</span>
<span class="co">#&gt; Use `task$collect()` to collect the results.</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Remove a task: When a task is finished and will not be used anymore, it is always recommended to remove it.</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">task</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>Removing a task will erase the entire folders from both client and server side.</p>
</div>
<div id="stop-a-server" class="section level3">
<h3 class="hasAnchor">
<a href="#stop-a-server" class="anchor"></a>2.3 Stop a server</h3>
<p>To stop a server immediately, call <code>stop_server</code> or <code>kill_server</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/restbatch-server.html">stop_server</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/restbatch-server.html">kill_server</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>If you want to keep the server running until the end of current R session, please use <code>autoclose_server</code>. This function will ensure the server is closed when you exit R session.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/restbatch-server.html">autoclose_server</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>When a server is closed, all unfinished (including the running tasks) will be <code>canceled</code>. These tasks will automatically restart once the server is launched again. However, in such case, the server will only use its half resources to execute restarted tasks, so that there are resources available for newly added ones. If you want to avoid restarting canceled tasks, please remove them (using <code>$remove</code> method).</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zhengjia Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
